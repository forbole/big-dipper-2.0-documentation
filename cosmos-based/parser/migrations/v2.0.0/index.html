<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<title data-react-helmet="true">v1.0.0 to v2.0.0 | Big Dipper 2.0 Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.bigdipper.live/cosmos-based/parser/migrations/v2.0.0"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="v1.0.0 to v2.0.0 | Big Dipper 2.0 Documentation"><meta data-react-helmet="true" name="description" content="This guide provides details for the upgrade from v1.0.0 to v2.0.0."><meta data-react-helmet="true" property="og:description" content="This guide provides details for the upgrade from v1.0.0 to v2.0.0."><meta data-react-helmet="true" property="og:image" content="https://docs.bigdipper.live/assets/cover.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.bigdipper.live/assets/cover.png"><link data-react-helmet="true" rel="shortcut icon" href="/assets/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.bigdipper.live/cosmos-based/parser/migrations/v2.0.0"><link data-react-helmet="true" rel="alternate" href="https://docs.bigdipper.live/cosmos-based/parser/migrations/v2.0.0" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.bigdipper.live/cosmos-based/parser/migrations/v2.0.0" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.bd168e87.css">
<link rel="preload" href="/assets/js/runtime~main.a8d21053.js" as="script">
<link rel="preload" href="/assets/js/main.9cbeb291.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/assets/logo.png" alt="Big Dipper logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/assets/logo.png" alt="Big Dipper logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Big Dipper 2.0 Documentation</b></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Cosmos Based Chains</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cosmos-based/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">BDJuno</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cosmos-based/parser/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cosmos-based/parser/database">1. Setup the database</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cosmos-based/parser/setup">2. Setup and run BDJuno</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cosmos-based/parser/hasura">3. Setup and run Hasura</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Config reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cosmos-based/parser/custom-chains">Custom chains</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Migrations</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/cosmos-based/parser/migrations/v2.0.0">v1.0.0 to v2.0.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cosmos-based/parser/migrations/v3.0.0">v2.0.0 to v3.0.0</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Big Dipper UI</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Solana</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">v1.0.0 to v2.0.0</h1></header><p>This guide provides details for the upgrade from v1.0.0 to v2.0.0.<br>
Since the release of BDJuno <code>v2.0.0</code>, certain address-specific data is no longer periodically parsed from the node and stored in the database.
Instead, the data is obtained directly from the node when necessary thanks to the <a href="https://hasura.io/docs/latest/graphql/core/actions/index.html" target="_blank" rel="noopener noreferrer">Hasura Actions</a> service.</p><p>Here&#x27;s the list of data which is acquired through Hasura Actions:</p><ul><li>Address/Delegator related data:<ul><li>Account balance</li><li>Delegation rewards</li><li>Delegator withdraw address</li><li>Delegations</li><li>Total delegations amount</li><li>Unbonding delegations</li><li>Total unbonding delegations amount</li><li>Redelegations</li></ul></li><li>Validator related data: <ul><li>Commission amount</li><li>Validator delegations</li><li>Validator redelegations</li><li>Validator unbonding delegations</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="update-branch-to-v2"></a>Update branch to v2<a class="hash-link" href="#update-branch-to-v2" title="Direct link to heading">#</a></h3><p>Pull the changes from <code>v2.0.0-stargate</code> (v0.42.x/stargate) or <code>v2.0.0</code> (v0.44.x and above)
tag to your branch depending on the cosmos sdk version being used in your project. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ git fetch --tags</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git checkout &lt;your chain base&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git checkout -b merge/v2.0.0-stargate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ git merge base-v2.0.0-stargate</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Fix all merge conflicts and then install the latest BDJuno version </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ make install</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start-hasura-actions"></a>Start Hasura Actions<a class="hash-link" href="#start-hasura-actions" title="Direct link to heading">#</a></h3><p>To activate Hasura actions, simply run: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ bdjuno hasura-actions</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>By default hasura-actions will listen to rpc and grpc on <code>127.0.0.1:26657</code> and <code>127.0.0.1:9090</code> ports. To pass custom address run</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ bdjuno hasura-actions --rpc &lt;custom-rpc-address&gt; --grpc &lt;custom grpc address&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It is also recommended to run Hasura Actions as a system service:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/systemd/system/hasura-actions.service </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Unit]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Description=BDJuno Hasura Actions</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">After=network-online.target</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c">
</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">User=</span><span class="token string environment constant" style="color:#36acaa">$USER</span><span class="token string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ExecStart=</span><span class="token string variable" style="color:#36acaa">$GOPATH</span><span class="token string" style="color:#e3116c">/bin/bdjuno hasura-actions</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Restart=always</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">RestartSec=3</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">LimitNOFILE=4096</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c">
</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Install]</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">WantedBy=multi-user.target</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Include flags</h5></div><div class="admonition-content"><p>Remember to include your custom configurations as flags at the <code>ExecStart</code> line if any.
Run <code>bdjuno hasura-actions --help</code> for more information.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="update-hasura-metadata"></a>Update hasura metadata<a class="hash-link" href="#update-hasura-metadata" title="Direct link to heading">#</a></h3><p>Change to hasura directory inside bdjuno repository and re-apply the metadata to include the hasura actions:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /path/to/bdjuno/hasura</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ hasura metadata apply --endpoint &lt;your-endpoint&gt; --admin-secret &lt;hasura_password&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="restart-services"></a>Restart services<a class="hash-link" href="#restart-services" title="Direct link to heading">#</a></h2><p>Restart the <a href="/cosmos-based/parser/setup#running-bdjuno">bdjuno service</a>, and
start the hasura actions service</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo systemctl restart bdjuno</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo systemctl start hasura-actions</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Once the bdjuno and hasura actions are working properly, optionally
you could drop the below DB tables along with the functions which will no longer be updated in the latest BDJuno version:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tables"></a>Tables<a class="hash-link" href="#tables" title="Direct link to heading">#</a></h4><ul><li>account_balance</li><li>delegation</li><li>redelegation</li><li>unbonding_delegation</li><li>delegators_to_refresh</li><li>validator_commission_amount</li><li>delegation_reward</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="functions"></a>Functions<a class="hash-link" href="#functions" title="Direct link to heading">#</a></h4><ul><li>self_delegations</li><li>is_delegation_self_delegate</li><li>account_balance_tokens_prices</li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"></div><div class="col lastUpdated_3DPF">Last updated on <b><time datetime="2022-07-06T09:42:33.000Z">7/6/2022</time></b></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cosmos-based/parser/custom-chains"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Custom chains</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cosmos-based/parser/migrations/v3.0.0"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">v2.0.0 to v3.0.0 Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#update-branch-to-v2" class="table-of-contents__link">Update branch to v2</a></li><li><a href="#start-hasura-actions" class="table-of-contents__link">Start Hasura Actions</a></li><li><a href="#update-hasura-metadata" class="table-of-contents__link">Update hasura metadata</a></li><li><a href="#restart-services" class="table-of-contents__link">Restart services</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"></div></div></footer></div>
<script src="/assets/js/runtime~main.a8d21053.js"></script>
<script src="/assets/js/main.9cbeb291.js"></script>
</body>
</html>