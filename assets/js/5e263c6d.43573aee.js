"use strict";(self.webpackChunkbig_dipper_2_0_docs=self.webpackChunkbig_dipper_2_0_docs||[]).push([[649],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>h});var a=o(7294);function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,a,s=function(e,t){if(null==e)return{};var o,a,s={},n=Object.keys(e);for(a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||(s[o]=e[o]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(s[o]=e[o])}return s}var l=a.createContext({}),d=function(e){var t=a.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):r(r({},t),e)),o},u=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var o=e.components,s=e.mdxType,n=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=d(o),c=s,h=p["".concat(l,".").concat(c)]||p[c]||m[c]||n;return o?a.createElement(h,r(r({ref:t},u),{},{components:o})):a.createElement(h,r({ref:t},u))}));function h(e,t){var o=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var n=o.length,r=new Array(n);r[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:s,r[1]=i;for(var d=2;d<n;d++)r[d]=o[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,o)}c.displayName="MDXCreateElement"},6019:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>n,metadata:()=>i,toc:()=>d});var a=o(7462),s=(o(7294),o(3905));const n={title:"Custom chains",sidebar_position:6},r=void 0,i={unversionedId:"cosmos-based/parser/custom-chains",id:"cosmos-based/parser/custom-chains",title:"Custom chains",description:"Creating a custom version of BDJuno is pretty straightforward. All you have to do is:",source:"@site/docs/cosmos-based/parser/custom-chains.md",sourceDirName:"cosmos-based/parser",slug:"/cosmos-based/parser/custom-chains",permalink:"/cosmos-based/parser/custom-chains",draft:!1,tags:[],version:"current",lastUpdatedAt:1682405329,formattedLastUpdatedAt:"Apr 25, 2023",sidebarPosition:6,frontMatter:{title:"Custom chains",sidebar_position:6},sidebar:"mySidebar",previous:{title:"Toml format (old)",permalink:"/cosmos-based/parser/config/config_old"},next:{title:"v1.0.0 to v2.0.0",permalink:"/cosmos-based/parser/migrations/v2.0.0"}},l={},d=[{value:"Fork BDJuno",id:"fork-bdjuno",level:2},{value:"Create a new branch",id:"create-a-new-branch",level:2},{value:"Add or update your dependencies",id:"add-or-update-your-dependencies",level:2},{value:"Add your application modules",id:"add-your-application-modules",level:2},{value:"(Optional) Add your custom addresses parser",id:"optional-add-your-custom-addresses-parser",level:2}],u={toc:d},p="wrapper";function m(e){let{components:t,...o}=e;return(0,s.kt)(p,(0,a.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Creating a custom version of BDJuno is pretty straightforward. All you have to do is:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"Fork the BDJuno repository."),(0,s.kt)("li",{parentName:"ol"},"Create a new branch for your project."),(0,s.kt)("li",{parentName:"ol"},"Add or update the dependencies based on your needs."),(0,s.kt)("li",{parentName:"ol"},"Add your application module managers."),(0,s.kt)("li",{parentName:"ol"},"(Optional) Implement a custom messages parser.")),(0,s.kt)("h2",{id:"fork-bdjuno"},"Fork BDJuno"),(0,s.kt)("p",null,"The first thing you need to do is ",(0,s.kt)("a",{parentName:"p",href:"https://docs.github.com/en/get-started/quickstart/fork-a-repo"},"forking"),"\nour ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/forbole/bdjuno/"},"BDJuno repository"),"."),(0,s.kt)("p",null,"This will allow you to create a new repository where you can work without any limits. It will also allow you to later\nupdate the base repo to make sure you have a constantly updated BDJuno codebase that does not fall behind ours."),(0,s.kt)("h2",{id:"create-a-new-branch"},"Create a new branch"),(0,s.kt)("p",null,"The next thing you want to do is create a new branch for your project. The best way to do this is by checking out one of\nthe ",(0,s.kt)("inlineCode",{parentName:"p"},"cosmos/")," branches and then create a new branch from there."),(0,s.kt)("admonition",{type:"info"},(0,s.kt)("mdxAdmonitionTitle",{parentName:"admonition"},"Select the correct Cosmos branch Currently BDJuno supports multiple Cosmos versions (you can see them all ",(0,s.kt)("a",{parentName:"mdxAdmonitionTitle",href:"https://github.com/forbole/bdjuno/branches/all?query=cosmos%2F"},"here"),")"),(0,s.kt)("p",{parentName:"admonition"},"It is important that when you create your new branch you checkout the one that is most similar to the Cosmos SDK your project is based on.")),(0,s.kt)("admonition",{title:"Custom SDK implementations If you are developing a project with a custom Cosmos SDK implementation, don't worry.",type:"info"},(0,s.kt)("p",{parentName:"admonition"},"We will see how to handle that later. For now, just check out the branch that is made for the Cosmos version most\nsimilar to the one you are based on.")),(0,s.kt)("p",null,"To checkout the branch you desire, just run:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"$ git checkout -t origin/<branch-name>\n\n# E.g.\n# git checkout origin/cosmos/stargate\n")),(0,s.kt)("p",null,"Now that you have checked out the Cosmos branch, you can create your own branch:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"$ git checkout -b chains/<project-name>\n\n# E.g\n# git checkout -b chains/my-project\n")),(0,s.kt)("p",null,"This will create a new ",(0,s.kt)("inlineCode",{parentName:"p"},"chains/")," branch that you can start working on."),(0,s.kt)("h2",{id:"add-or-update-your-dependencies"},"Add or update your dependencies"),(0,s.kt)("p",null,"Now it's time to add the dependencies that your project needs. For these steps, we will take as\nexample ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/desmos-labs/desmos/"},"Desmos"),"."),(0,s.kt)("p",null,"The first thing we want to do is add Desmos as a dependency:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-shell"},"$ go get -u github.com/desmos-labs/desmos@v2.3.0\n")),(0,s.kt)("p",null,"This will edit your ",(0,s.kt)("inlineCode",{parentName:"p"},"go.mod")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"go.sum")," files including the Desmos dependency."),(0,s.kt)("p",null,"Then, we need to make sure that the project we want to use does not use some custom dependencies. To do this, we can\ntake a look at ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/desmos-labs/desmos/blob/v1.0.0/go.mod"},"its ",(0,s.kt)("inlineCode",{parentName:"a"},"go.mod")," file")," and search for\nany ",(0,s.kt)("inlineCode",{parentName:"p"},"replace")," directives."),(0,s.kt)("p",null,"In our case, Desmos uses some custom dependencies:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"replace github.com/gogo/protobuf => github.com/regen-network/protobuf v1.3.3-alpha.regen.1\n\nreplace github.com/cosmos/cosmos-sdk => github.com/desmos-labs/cosmos-sdk v0.43.0-alpha1.0.20211102084520-683147efd235\n\nreplace google.golang.org/grpc => google.golang.org/grpc v1.33.2\n\nreplace github.com/tendermint/tendermint => github.com/forbole/tendermint v0.34.13-0.20210820072129-a2a4af55563d\n")),(0,s.kt)("p",null,"What we need to do, is edit BDJuno's ",(0,s.kt)("inlineCode",{parentName:"p"},"go.mod")," file by adding the same ",(0,s.kt)("inlineCode",{parentName:"p"},"replace")," directives. This will make sure that\nBDJuno uses the same Cosmos SDK fork and other dependencies and does not error due to incompatibility problems."),(0,s.kt)("h2",{id:"add-your-application-modules"},"Add your application modules"),(0,s.kt)("p",null,"Once you have added the dependency to your project, it is not time to use such dependency inside BDJuno."),(0,s.kt)("p",null,"This will be used to tell BDJuno which modules you support to make sure that it is able to properly deserialize all your\nmessages. Failing in doing this will result in BDJuno returning an error each time a custom message is to be parsed from\na transaction."),(0,s.kt)("p",null,"To tell BDJuno which modules you support, you need to change what the\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/forbole/bdjuno/blob/cosmos/stargate/cmd/bdjuno/main.go#L54-L58"},(0,s.kt)("inlineCode",{parentName:"a"},"cmd/bdjuno/main.go#getBasicManages")),"\nfunction returns by adding your project's ",(0,s.kt)("inlineCode",{parentName:"p"},"ModuleBasics"),". As an example, for Desmos we will change it to be"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},"func getBasicManagers() []module.BasicManager {\n    return []module.BasicManager{\n        simapp.ModuleBasics,\n        desmosapp.ModuleBasics, // <--- We have added this line\n    }\n}\n")),(0,s.kt)("admonition",{title:"Your modules should be last",type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"Make sure that you set your ",(0,s.kt)("inlineCode",{parentName:"p"},"ModuleBasics")," to be the last one in the slice.\nThis will make sure that if you have any module that is named the same way as a Cosmos one (maybe because you use a custom implementation), the custom one will be used correctly.\nIf you set your modules first, the Cosmos ones will override them.")),(0,s.kt)("h2",{id:"optional-add-your-custom-addresses-parser"},"(Optional) Add your custom addresses parser"),(0,s.kt)("p",null,"Inside BigDipper, when you visualize the details of an account you are able to see all the messages that it was involved in.\nThis is done by parsing each message to get the involved addresses.\nBy default, inside BDJuno we do this only with the Cosmos messages, and then we rely on the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/3f8596c1955e40ef30e4abcd06f2237d132db3a9/types/tx_msg.go#L21"},(0,s.kt)("inlineCode",{parentName:"a"},"Msg#GetSigners")," method"),"."),(0,s.kt)("p",null,"Although this works great for most messages that involve a single user (the signer), your project might include some messages that involve more addresses.\nFor example, you might have a message that allows to send funds from one user to the other. Or a message that allows one user to perform a kind of action towards another one."),(0,s.kt)("p",null,"If this is the case, it is important that you build a custom addresses parser inside BDJuno to make sure that each message is associated with the proper list of addresses, and that the associated accounts are refreshed correctly once the message is parsed (especially if it edits both account balances)."),(0,s.kt)("p",null,"To do this, what you can do is create a new file inside the ",(0,s.kt)("inlineCode",{parentName:"p"},"cmd/bdjuno")," folder naming it after your project.\nInside that file, you need to create a function with the following signature:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},"// CustomAddressesParser represents a MessageAddressesParser for the my custom module\nfunc CustomAddressesParser(cdc codec.Marshaler, cosmosMsg sdk.Msg) ([]string, error)\n")),(0,s.kt)("p",null,"This method should return either a list of all the parsed addresses or ",(0,s.kt)("inlineCode",{parentName:"p"},"messages.MessageNotSupported(cosmosMsg)")," if the message is not supported."),(0,s.kt)("p",null,"If you want to take a look at a reference implementation you can refer to the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/forbole/bdjuno/blob/chains/desmos/mainnet/cmd/bdjuno/desmos.go"},"Desmos one"),"."),(0,s.kt)("admonition",{title:"Combine multiple parsers",type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"If you have multiple modules that should be parsed in different ways, we suggest you splitting them into different parsers and then combining those parsers together using the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/forbole/juno/blob/cosmos/v0.44.x/modules/messages/account_parser.go"},(0,s.kt)("inlineCode",{parentName:"a"},"messages.JoinMessageParsers"))," method.\nYou can see how this is used for Desmos ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/forbole/bdjuno/blob/chains/desmos/mainnet/cmd/bdjuno/desmos.go"},"here"),".")),(0,s.kt)("p",null,"Finally, once you have your custom addresses parser setup, you need to add it to the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/forbole/bdjuno/blob/chains/desmos/mainnet/cmd/bdjuno/main.go"},(0,s.kt)("inlineCode",{parentName:"a"},"cmd/bdjuno/main.go#getAddressesParser"))," method. Here is the example for Desmos:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},"func getAddressesParser() messages.MessageAddressesParser {\n    return messages.JoinMessageParsers(\n        desmosMessageAddressesParser,\n        messages.CosmosMessageAddressesParser,\n    )\n}\n")),(0,s.kt)("admonition",{title:"Your parser should be first",type:"tip"},(0,s.kt)("p",{parentName:"admonition"},"Make sure you set your parser to be the first one used. Otherwise, the ",(0,s.kt)("inlineCode",{parentName:"p"},"CosmosMessageAddressesParser")," will default to using the ",(0,s.kt)("inlineCode",{parentName:"p"},"Msg#GetSigners")," method and your parser will never be called, even though BDJuno will not return any error.")))}m.isMDXComponent=!0}}]);