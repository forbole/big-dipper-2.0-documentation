"use strict";(self.webpackChunkbig_dipper_2_0_docs=self.webpackChunkbig_dipper_2_0_docs||[]).push([[335],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),u=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=u(a),m=r,h=p["".concat(l,".").concat(m)]||p[m]||c[m]||o;return a?n.createElement(h,i(i({ref:t},d),{},{components:a})):n.createElement(h,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<o;u++)i[u]=a[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},2513:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return d},default:function(){return p}});var n=a(2122),r=a(9756),o=(a(7294),a(3905)),i=["components"],s={title:"v1.0.0 to v2.0.0",sidebar_position:1},l=void 0,u={unversionedId:"cosmos-based/parser/migrations/v2.0.0",id:"cosmos-based/parser/migrations/v2.0.0",isDocsHomePage:!1,title:"v1.0.0 to v2.0.0",description:"This guide provides details for the upgrade from v1.0.0 to v2.0.0.",source:"@site/docs/cosmos-based/parser/migrations/v2.0.0.md",sourceDirName:"cosmos-based/parser/migrations",slug:"/cosmos-based/parser/migrations/v2.0.0",permalink:"/cosmos-based/parser/migrations/v2.0.0",version:"current",lastUpdatedAt:1657100553,formattedLastUpdatedAt:"7/6/2022",sidebarPosition:1,frontMatter:{title:"v1.0.0 to v2.0.0",sidebar_position:1},sidebar:"mySidebar",previous:{title:"Custom chains",permalink:"/cosmos-based/parser/custom-chains"},next:{title:"v2.0.0 to v3.0.0",permalink:"/cosmos-based/parser/migrations/v3.0.0"}},d=[{value:"Update branch to v2",id:"update-branch-to-v2",children:[]},{value:"Start Hasura Actions",id:"start-hasura-actions",children:[]},{value:"Update hasura metadata",id:"update-hasura-metadata",children:[]},{value:"Restart services",id:"restart-services",children:[]}],c={toc:d};function p(e){var t=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This guide provides details for the upgrade from v1.0.0 to v2.0.0.",(0,o.kt)("br",{parentName:"p"}),"\n","Since the release of BDJuno ",(0,o.kt)("inlineCode",{parentName:"p"},"v2.0.0"),", certain address-specific data is no longer periodically parsed from the node and stored in the database.\nInstead, the data is obtained directly from the node when necessary thanks to the ",(0,o.kt)("a",{parentName:"p",href:"https://hasura.io/docs/latest/graphql/core/actions/index.html"},"Hasura Actions")," service."),(0,o.kt)("p",null,"Here's the list of data which is acquired through Hasura Actions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Address/Delegator related data:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Account balance"),(0,o.kt)("li",{parentName:"ul"},"Delegation rewards"),(0,o.kt)("li",{parentName:"ul"},"Delegator withdraw address"),(0,o.kt)("li",{parentName:"ul"},"Delegations"),(0,o.kt)("li",{parentName:"ul"},"Total delegations amount"),(0,o.kt)("li",{parentName:"ul"},"Unbonding delegations"),(0,o.kt)("li",{parentName:"ul"},"Total unbonding delegations amount"),(0,o.kt)("li",{parentName:"ul"},"Redelegations"))),(0,o.kt)("li",{parentName:"ul"},"Validator related data: ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Commission amount"),(0,o.kt)("li",{parentName:"ul"},"Validator delegations"),(0,o.kt)("li",{parentName:"ul"},"Validator redelegations"),(0,o.kt)("li",{parentName:"ul"},"Validator unbonding delegations")))),(0,o.kt)("h3",{id:"update-branch-to-v2"},"Update branch to v2"),(0,o.kt)("p",null,"Pull the changes from ",(0,o.kt)("inlineCode",{parentName:"p"},"v2.0.0-stargate")," (v0.42.x/stargate) or ",(0,o.kt)("inlineCode",{parentName:"p"},"v2.0.0")," (v0.44.x and above)\ntag to your branch depending on the cosmos sdk version being used in your project. "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ git fetch --tags\n$ git checkout <your chain base>\n$ git checkout -b merge/v2.0.0-stargate\n$ git merge base-v2.0.0-stargate\n")),(0,o.kt)("p",null,"Fix all merge conflicts and then install the latest BDJuno version "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ make install\n")),(0,o.kt)("h3",{id:"start-hasura-actions"},"Start Hasura Actions"),(0,o.kt)("p",null,"To activate Hasura actions, simply run: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ bdjuno hasura-actions\n")),(0,o.kt)("p",null,"By default hasura-actions will listen to rpc and grpc on ",(0,o.kt)("inlineCode",{parentName:"p"},"127.0.0.1:26657")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"127.0.0.1:9090")," ports. To pass custom address run"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ bdjuno hasura-actions --rpc <custom-rpc-address> --grpc <custom grpc address>\n")),(0,o.kt)("p",null,"It is also recommended to run Hasura Actions as a system service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ sudo tee /etc/systemd/system/hasura-actions.service > /dev/null <<EOF\n[Unit]\nDescription=BDJuno Hasura Actions\nAfter=network-online.target\n\n[Service]\nUser=$USER\nExecStart=$GOPATH/bin/bdjuno hasura-actions\nRestart=always\nRestartSec=3\nLimitNOFILE=4096\n\n[Install]\nWantedBy=multi-user.target\nEOF\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Include flags")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Remember to include your custom configurations as flags at the ",(0,o.kt)("inlineCode",{parentName:"p"},"ExecStart")," line if any.\nRun ",(0,o.kt)("inlineCode",{parentName:"p"},"bdjuno hasura-actions --help")," for more information."))),(0,o.kt)("h3",{id:"update-hasura-metadata"},"Update hasura metadata"),(0,o.kt)("p",null,"Change to hasura directory inside bdjuno repository and re-apply the metadata to include the hasura actions:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ cd /path/to/bdjuno/hasura\n$ hasura metadata apply --endpoint <your-endpoint> --admin-secret <hasura_password>\n")),(0,o.kt)("h2",{id:"restart-services"},"Restart services"),(0,o.kt)("p",null,"Restart the ",(0,o.kt)("a",{parentName:"p",href:"/cosmos-based/parser/setup#running-bdjuno"},"bdjuno service"),", and\nstart the hasura actions service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ sudo systemctl restart bdjuno\n$ sudo systemctl start hasura-actions\n")),(0,o.kt)("p",null,"Once the bdjuno and hasura actions are working properly, optionally\nyou could drop the below DB tables along with the functions which will no longer be updated in the latest BDJuno version:"),(0,o.kt)("h4",{id:"tables"},"Tables"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"account_balance"),(0,o.kt)("li",{parentName:"ul"},"delegation"),(0,o.kt)("li",{parentName:"ul"},"redelegation"),(0,o.kt)("li",{parentName:"ul"},"unbonding_delegation"),(0,o.kt)("li",{parentName:"ul"},"delegators_to_refresh"),(0,o.kt)("li",{parentName:"ul"},"validator_commission_amount"),(0,o.kt)("li",{parentName:"ul"},"delegation_reward")),(0,o.kt)("h4",{id:"functions"},"Functions"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"self_delegations"),(0,o.kt)("li",{parentName:"ul"},"is_delegation_self_delegate"),(0,o.kt)("li",{parentName:"ul"},"account_balance_tokens_prices")))}p.isMDXComponent=!0}}]);